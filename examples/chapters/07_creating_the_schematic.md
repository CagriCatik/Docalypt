# Creating the Schematic



that's what I'll do so I select the first item in the list hold the shift button on my keyboard and scroll down and while I'm holding the shift key click on the last item to highlight everything and then click on open and you can see that now all of these symbols and the symbol libraries have been selected and they are under the Project Specific libraries and click okay and now I'm ready to get started with the schematic here's the blank schematic editor and the plan here is that I'm going to have a total of four

pages in the first page I'll have the USB and power related components then in the second page I'll have the esp32 the module plus the usbt converter and a couple of LEDs then I'm going to have another page for the sensors and finally uh another page for the user interface so I'll be creating these Pages as I go and then providing Connections in between the pages let's start dropping some components start with the uh sheet page settings I just want to uh add my date here I give it a the title so this going to be ESP 32 sensor board you can

add more details there as you wish all right so you can see that information that text appears down the bottom let's begin with the USB receptacle so I'm just going to either click on this button right here on the top right toolbar Place symbols or use the a hot key to bring up the symbol Chooser so remember that here I'm using or I want to use the SS 52400 receptable that I downloaded earlier from snap magic so I'm just going to search for that SS there you go came up that's the one that I want I can either double click on

the item or just click on okay and I'll place that around here going to rearrange my symbols a bit later the next major component is the lipo charger and I'm looking at my bill of materials and the item that I'm looking for is this one here the mCP 7387 the AK to bring up the Chooser and I'm now going to search for MC P [Music] 7387 and it's this component here so click okay and I'll place it around there next up I've got the voltage regulator so again click anywhere in the sheet and looking at my bomb the regulator is this item right here the

lm1117 so search for that lm1117 click okay and I'll place it around here so I'm already starting to create areas where all related components will be going together so this part here is going to be where all the USBC related components are going to be this area here is going to be where all the ball charger components will be here is the regulator move that up a little and I also have the battery connector so I'm going to add that as well so the battery connector that I want to use is the jst T connector looks like that click okay

and place that right there for each one of those components I need of course the supporting components for the circuitry I'm going to drop all the resistors that I need on this sheet and then I'll continue with capacitors and LEDs so let's start with the resistors I'm going to hit the a key on my keyboard here in the Chooser I'll select R already done it but I'll select R double click on it and I'm going to start with say here I'm going to draw this resistor right there where it's going to be eventually connected and then double click on it to

change its value so this going to be a 10 kilm resistor this going to be a pull down resistor I need one more of them so I'm going to type command D on my keyboard to create a duplicate and I'll drop it right here and just I'm going to move the designator and the value a little just so that there's no overlap in this one is also going to be 10 kohms so that's fine as it is so next up let's have a look at the resistance array on J1 so I'm just going to type a bring up this resistor I'm going to place it around here this going to be another

pull down for the C2 line and the value for this resistor is 5.1k I'm Mark it down as 5k1 I could have done it something like this for example 5.1 K but I find that the dot sometimes is not easy to see and therefore can be misread whereas if I do something like 5k1 it's much easier to get the information correctly that this is a 5.

1 kiloohm resistor also if you're wondering where I get the value for the particular resistor I'm just going to connect it right now just to make it a bit more clear so this supp pull down resistor for the CC two line then the answer is the USB data sheet and I'm going to have another similar resistor on the other side for CC1 is just going to be another 5.

1k resistor that will go right there course to draw a line which represents a wire I simply click on the pin and the drawing tool will automatically start drawing a wire to stop drawing and just double click or if you want to cancel the drawing operation just hit the Escape key all right I haven't finished the wiring here I'm going to add the ground symbols a bit later so also if you want to move things around you can just place your cursor on the thing that you want to move and then just type the m key on the keyboard or you can just click with your

mouse and drag notice that when you do that the wire that I've already drawn it gets interrupted and then I have to redraw it alternatively you can see if you do a right click to bring up the context menu there is the drag option which you can use the G shortcut to activate and that ensures that any wiring you've already done is not being cut or removed and then click again to finish the drawing okay so I've got R1 R2 R3 R4 going to go back to my U1 component so I'm going to add a couple of additional pull down resistors so

just the a key again the r it's going to be one here and I'm just going to duplicate this one here another one they've got different values so the R5 will be 2K and the R6 is going to be 20ks and while I'm at it I'm just going to do the drawing as well here's a yre for Te negative and the THM and these two we'll go to ground I'll do the ground now so don't forget so for some reason my Chooser power symbol Chooser is not coming up properly formatted and this pen on the side is just folded anyway it's not hard to expanded so here I'm

going to pick up the ground I can just search for gnd this is just another symbol but he could provides a separate menu item here on the side to make it easier to find so there a ground and all draw a line to connect it to R1 and R2 so these two are pull down resistors and I've got the same thing down the bottom for R5 and R six duplicate that ground symbol connect the two resists together and finish the connection like that and the R5 goes to prog one and R six goes to prog three now if you're wondering again how I know

how to do the wiring here again the answer is the data shade so this is the mCP 73871 and you can see in the data sheet there are example typical applications and I'm simply following the example that's given to me by the manufacturer nothing fancy here and I'm not making things these up this is what the manufacturer suggests on the other side of of this U1 component I've got some indicator LEDs so I'll bring up a few more resistors first to protect the LEDs from overcurrents so this going to be our seven and this is going to be

470 ohms so duplicate it a couple of times R8 and R9 and these go to these three pins so R9 will go to PG r R8 will go to SDA 1 and R7 will go to SDA 2 these indicate that the battery is either charging or it is already charged for the LEDs I found the computer I want to use from snapa and as per my bomb you can see I've got three different types I've got our red a green and a blue I've already imported those to kard so I'm just going to sech search first for the red one which is the ltst red this one right here so import

that into my schematic Orient appropriately and that's done I want one more I'm not going to duplicate this because the next one I want is a green one so back to the Chooser and this one is a green okay like that just going to make a little bit of room between those and I've got one more this the last one is going to be the blue right there I can type the m key on my keyboard to move things around all right and then finish with the connections one goes there there and there the bottoms of the LEDs or the anodes of the LEDs are connected

to the same place which doesn't yet exist is that's a net that I'm going to call 5V USB which doesn't exist yet as I said I'm going to connect it in a minute so I'm just going to leave these wires unconnected for the time being I'm just going to add a couple of grounds I'm just going to duplicate this ground and move it over here and finish this wiring here do one more and finish that wiring right there a couple of other grounds that I'll connect while I'm at it is is this so gnd D just duplicate and connect a12

which is gnd D A2 to ground there's also one more ground I'm just going to go straight there instead of introducing new symbols so these two pins also go to ground this one will ground up [Music] here like that move that down a bit and of course one more on the other side right there done I'll continue my work with the USB connector before I move to the other components I think at this point I've got enough already set up here to allow me to complete one part of the schematic before I move to the other parts I'm just going to make a

little bit of room to the part of the schematic that I'll be working for the next few minutes and that is the connector on the connector I also want to include a couple of things especially the polyfuse to help protect my board from over current so that polyfuse is connected right there on the vbus B1 pin I've already selected the fuse to use so it's this one right here so I'm just going to search for B fuse and the component should already be available there search for B fuse yes it's right here so that's the one I want to use so

click okay I'll place it right here I want to have a straight line so I'm just going to make a little change going to remove that line actually I'm going to remove all of this and move the ground a little bit closer to the pin and connect it in like that now for the fuse that gets connected to this pin right there that's where power goes into from the USB bus and then on the other side again that's the USB bus that comes from the power ciruit next I'm going to add a capacitor that will act as an input filtering capacitor add a new component

it's going to be a just a regular capacitor nothing fancy I'm going to place that say around here where there is space and the value for this capacitor is 0.1 U or micro farat I use G to move that a little more okay here is a good place to connect it to the polyfuse just like that and going going to duplicate the ground symbol and connect it right there just going to make a little bit of room select all these together type G and move everything a little bit to the right so I think that's it with J1 and wirings I'm going to connect the

remaining pins to particular Nets or I will mark them as unconnected to Mark a pin as unconnected I'm going to use this button here uh place no connect flags and that allows me to just click on a pen that I want to tell Kik that it's not going to be connected to anything so that that will suppress any error messages later on like that so sb1 will also be unconnected and then up the top got these two that will be left unconnected on the other side is B2 and B3 B9 sorry B8 and then B10 and 11 so let's save at this point speaking of

save if you go to kick at setting have a look at this area here in common project backup automatically backup projects so actually I want to make sure that I don't lose any work so I'm going to have lots of backups let's say 10 per day every 5 minutes you don't want to lose any work and since I'm working with a release candidate version of Ky out I'd rather be safe than sorry I've got my J1 almost finished the next thing that I want to do is to start creating some Nets so I'm I'm going to use the net label tool right here you can use the L

shortcut for label and with that you can start creating labels I'm going to have a net named bus just type the I key to rotate it and Orient it appropriately and this going to be vbus dp1 and N D1 uh so DP for positive n for negative this is going to be a differential pair for the data pinch of the USB connector so click here to bring up the label properties and this going to be USB DP or data positive so it goes in here and I'm just going to duplicate that hit Escape select the label I want to duplicate and type command or control

b d click that to connect it to A7 and then double click again to bring up the properties and make that P and n for negative so I've got DP and DN then the letters here at the very end of the two labels is important because p and N indicate to kick it that this is a differential pair and we are going to use this feature to do the wiring later on in the layout there is also one more VBS I'm just going to duplicate that and connect another vbus wire right there so vbus A2 and vbus A1 connected to the same net on the other side I've got two

more differential pairs for data these are short circuited they're physically connected in the connector so that's why the part of the same net so I'm going to duplicate DP flip it over on that side and it's going to be a p right there and then the N or the negative of the differential pair right there another vbus label right there duplicate done this is going to be vbus 2 and finally I need to mark this wire as a member of the vbus net so this going to be vbus B1 there's one more net to create just going to use the L key for

that and this is going to be the plus 5V USB net which goes there using the G key to move move everything a little bit further in okay that's it this is the USB connector I'm going to do another check a little later but I think for now that's enough works I'm just going to draw a little box around it and give it a label just to make it easy to see when I'm quickly looking at the schematic diagram that this is a block of components that belong together and they play a particular role so this is a USB connector like that going to continue

now with this part of the first page of the schematic now that I have the vbus 5 Vol vbus I'm just going to duplicate it and finish up the wiring of the LEDs so these go like that and just going to mark that here as the V bus now I'm going to continue to implement the wiring for the lipo charger integrated ciruit just by following the recommendations of the data sheet from microchip technology the manufacturer of this particular integrated circuit so I'm just going to continue essentially copying what I see in the data sheet so I've got one more 5

Vol USB pin PR two I need to bring that up to 5 Vols for vibat sense just going to short that with vbat and then Mark this net with a name so type the L key and this is going to be the vbat net mark it like that or out this is the reason for the existence of this particular chip is whatever comes out of this pin and I'm going to create a new named net with the name + 5 volts so that's what comes out of this particular chip so on vsss I'm going to connect this to ground you can see that's what the data sheet is telling us to do so

this is going to go to ground just going to duplicate ground symbol oriented like that and Mark it like this now one thing to keep in mind I'm just going to bring up the symbol and have a look having a look at the vsss you can see that that is marked as a power input so if I leave my schematic like this so vsss directly connected to gnd D I'm going to get an error message from Kad later on want to do the ERC check so to prevent that from happening I'm going to go back to the power symbol Chooser and search for a

flag this power flag here and attach this flag to V SS and that will suppress that error message from kard and indicate to kard that yes I do know that this is a Power Pin and I've already taken care of that don't worry about it let's go down to the bottom pin 18 is in and that's where where we apply the 5V USB power it's coming out of here the PCC that's connected right there and going to copy the flag and plug that into here so basically pin two and pin 18 are connected to the 5V USB input power here I also need the filter

capacitor so I'm just going to bring another capacitor and drop it in there this one is going to be just one U and I'm going to change the reference to C6 just to keep in sync with my notes Here CU I'm going to have a few other capacitors with different IDs I want to be a little bit more in control of the designators so normally I will allow kyat to come up with whichever designator it wants for new components that I'm dropping on the schematic shade but in this case I want to have a little bit more control as I said so I'm going

to go ahead and rename this AA 2 C6 then we'll connect that to ground done with that let's have a look anything else I've got yep I've got C up here which also needs to go to 5 Vols USB I think this part of the schematic is done so hit Escape select the whole thing and move it down a little and then put a box around it to indicate to the reader or myself in this case and you that this is a set of components that belong together and I'm going to put a label here as well and this is going to be the lipo charger done the next thing is the low

Dropout voltage regulator I'm going to follow the instructions from the data sheet and in particular I'll Implement A variation of this recommendation here for a fixed output regulator on the the inside I need two capacitors one of them is going to be ceramic and the other one is going to be talum so so this one is the ceramic capacitor I'll place it right there double click to get its properties and this is going to be a 0.

1 U capacitor and this is C2 that's correct again just sking in sync with my notes I also need a talum capacitor so a key again talum is basically an electrolytic capacitor I'm just going to search for C and this a polarized I'm going to use this polarized capacitor symbol for tandum and place it right there double click change the value to 10 microfarads like that and I'll have the exact same thing on the other side as well so I'm going to select these two and duplicate them and move the group of the two capacitors to the other side just going to change the names I want

this to be C5 and this to be C4 so I'm going to have C5 which is going to be 0.1 just going move it on the other side just keep a note here the placing of the capacitors is important so I just flipped the ceramic with the electrolytic capacitor because I want the electrolytic capacitor tandum in my case to be closer to the pins on the integrated circuit that it will be connected to in this case is going to be the 2v out pins in other words the proximity of components to other components is important in the schematic

just as it is in the layout when I see that C4 is close to V out 2 and V out 4 I know that I need to place C4 very close to those two pin in the layout as well VN goes there so I've got the two filters and I've got the ground just going to duplicate the ground symbol place it right there and finish the connection on that side and then there's a label I'm going to place this label is going to be plus 5 Vol so 5 Vols goes into this regulator and 3.

3 Vol comes out on the other side I'm going to use a power symbol for the output so on the output I have 3.3 volts and there is a symbol for that so I'm going to use that instead of creating my own custom label so it's going to be this symbol right there all right so V out 2 and V out 4 go to the same place we've got 3.

3 volts coming out of this voltage regulator and for the filtering part we also have these two capacitors as I said C4 I'll be connecting it very close to those two pin to improve the performance of the filtering and just like I did up here with a power flag I'm going to use the same power flag here to tell Kat that I'm aware that this particular component we have a look if you have a look in the simple editor you'll see these two pins are power inputs I'm telling kard that I know about that fact and it doesn't need to worry about bringing up an error

message when I do the ERC check later on because it's been taken care of and I've got the ground component as well for these capacitors and there's one more ground I'm just going to give this one its own ground actually just duplicate just for clarity I could have connected this ground pin straight here and share the same ground symbol as the capacitors but I want it to be a little bit independent in this case I think it looks better as well so I'm just going to leave it like that now one thing I'm going to improve here is I just realized

that I've got a 5V label here and a 3.3 Vol symbol label on the other side just want to be consistent so I'm going to remove that manual or custom label and replace it with an actual 5V label from Kad actually I'm going to use one of those so 5 V I'm going to use this label like that just rotate it okay that's better select all these type G just to move things in a bit and I think this block of components is now complete just going to move it all up a little like that and put a box around it this going to be the low Dropout or ldo insured

voltage regulator uh I also have the battery connector that's going to be quick to connect and I'm also going to add a power indicator LED in a moment so let's have a look at this component the battery connector I'm going to rotate that so that the pins face inwards and on one side I want to add a vbat label same label that I used here in the little battery charge integrated circuit so I'm just going to copy that duplicate it and connect it there and the other one of course is going to be the ground level done so let's put that in the Box

and give it a name next up I want a indicator for power so I'm going to grab a copy of the red LED and its current limiting resistor I'm just going to duplicate these two rotate like that and place it say around here and the idea here is that when there is power then 3.3 volts is going to come out of the regulator into this LED and then of course into ground and the LED will let us know that power has been applied to the Circuit at a label here even though this is not really necessary but Power LED I'm just going to give it a named net so I can

see this particular net in the layout easier later on so done with that first page is pretty much done the only next thing that I want to do is to add a hierarchical shade symbol so that I can then connect this shade to the next one up in the hierarchy so I'll select this tool click on it and then just draw a little box here do that again yep like that I'm going to give this sheet a name and what this sheet is going to contain is the esp32 and related Hardware so I'm just going to put in here esp32 [Music] c302 that's the main component that's

going to be in that sheet and I'm going to change the name for the sheet file as well ESP 32 C3 02 so I'll be able to see that file in the file system in a moment and I know what it is about so save then have a look you can see I go back one level I've got my new sheet just right there along the rest of the sheets that make up the project you skip a couple of times to exit the tool so now I've got the second shade you can see that it also appeared here the second sheade is blank before I go over to work on the

esp32 sheet I just notice a couple of things are to fix that has to do with the LEDs and the colors of the LEDs and the pins to which each of these is connected to and I also want to introduce a couple of labels as well just to make it easier to see and understand the role of each of these wires when I'm working on the layout editor first thing to do is just notice that this red LED is connected to stat 2 stat 2 is the pin that indicates charging however I want the red LED to indicate that charging power is good I

can either do that by rearranging those wires or just moving the LEDs around actually that's what I'll do I'm just going to remove those wires to release the LEDs and move those around so I want the blue LED to be connected to stat 2 and stat 2 indicates charging of the battery so blue LED means charging the green LED indicates charged and it's connected to Stat one so that is fine as it is should not have removed those wires so let's place that here and rewire everything now the other thing that I want to do is I said earlier is to use

use labels to Mark the functionality of these wires and that makes it easier later on in the layout to know what wire I'm dealing with so this one is going to be charging power good I'm just going to double click because a is missing all right second one is going to be charged and the last one is going to be charging so that's done as well now I've got one more label that is missing this one here actually just noticed this should be 5 Vols I'm just going to copy that duplicate it and that is going to be a 5V label and I just notied one more
