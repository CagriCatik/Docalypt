# Differential Pairs and High-Speed Signal Routing



one is down here you can see I've got USB DP and USB DN those pads up here need to be connected to this and this pad right there and then a little further up I have USB D plus and USB D minus right here two pads and the other two pads down here let's get started with that I'm going to select the differential pair tool from here the problem that I'm having here is I'm clicking revealing the menu I'm trying to select differential pairs but it won't let me so I'm going to try by using the keyboard shortcut which is six

and start from the bottom so again with a six to start the pair now it's going to probably work maybe not again so the problem here maybe it's positioning but also you can see that there is a clearance the pads up there are very close to each other so the clearance may be a problem the first thing I'll do though is to move u4 a little bit to the left so that it's properly aligned I'm going to unlock it and just move it a little bit to the LIF then try again with a differential pair now this is still not helping very

much I'm going to try again with a smaller track and clearance so let's try that six shortcut [Music] and yes this time it did work it's not very nice though so I'm just going to move youu for a little bit to the left J just a little more and clear these tracks attempt once again so six instead effect X start drawing yeah and now they look better so that that differential pay is done let's try the other side now so I've got DP and DN down here start drawing here I've already got the appropriate tool selected but you can

see I can't get through because of the vbus pad in the middle so I'm going to try from the other side top to bottom one thing that I'll do is to see if I can move these two components a little higher so I'm going to unlock and move up a [Music] little and that should not affect the differential pair drawings up the top end of this component now that I've got a bit more space between the two pairs of pads that I'm trying to connect I'm going to start again typing six on my keyboard starting to draw going to go up to about here and

then finish yeah and that worked problem here is that the VBS pad will need to be connected to the VBS net I prefer to do it around here using a VR instead of some other way passing tracks in between those pads so what I'll do is I'm going to drag and redraw those lines that I already Drew using the differential pair tool so I'm going to use the D key the D key allows me to drag in 45Â° mode so D and let's move things like this here and like that and just fix that bit down here little more to have symmetry yeah that looks

good one more thing I'm going to fix is these two segments so that's it with the differential pairs next up I'll work on the tracks for the two highspeed interfaces especially the SBI and then I'm going to work on the ice quit c as well I'm going to continue drawing the tracks for the ice quit C interface and those tracks include the SE and the SDA lines the good news about this is that ice quid C typically operates at speeds of up to 400 khz in standard mode and we're not going beyond that in this example application in this PCB it can

go up to 1 MHz though in fast mode and at these frequencies minor differences in track lengths won cause significant skew or timing issues also perfect matching of Trace lengths is not critical for i s c still I'm going to try and keep the lengths of those two tracks as close as possible I need to pass those tracks through the BME sensor and from there it will also travel to the header for the display another thing to to remember about ice quit see is that you want to keep those traces away from highp speed signals and other

potential sources of interference the good thing about the layout of this design is that the SPI components are down here on the board and there's one of course here I'm going to move it a little bit further down and that leaves the traces for the I quid see quite isolated on the top end of the board okay so let's do that now um as I said I'm just going to move U6 a little bit to the bottom or towards the bottom of the board lock it up again I'm just going to pick the normal drawing tool I can just type X on my keyboard and start

drawing is on the top side of the board click there then I'm going to connect SDA as well like this just improve traces as I [Music] go minimize wasted space after that I'm going to connect the two seal traces together and I'm going to go in between the the pads and connect that to pad two so I don't have to switch Layer like that from here let's continue going to continue with SC across the corner that goes all the way to pad 15

so at this point I will switch to the bottom copper layer use a V for that continue up to about here then go back to the surface via and connect to sccl let's do the same thing for SDA start drawing at the top copper layer going fix those ugly traces in a moment here switch to the bottom continue up to around here and that oh actually the SDA is all the way back here so let's retrace I'm going to move this via since I've already drawn it I'll move it here and then from here go to the top layer and with X continue to

SDA so let's fix quality of this drawing okay that looks much better now one thing to notice of course is that SC the clock is much longer than SDA I would actually like to improve that and get them as close as possible to do that I'm going to start by checking out to see exactly how long these lines are you can see down the bottom that the routed length for the SE line is 68.

29 mm the number for SDA is 52.3 going to do two things if possible I will reduce the length of se but I don't really think it is possible looking at how it's configured I don't think it's possible to reduce it therefore the other thing that I can do is to increase the length of the SDA line there's a couple of ways to do that uh one simple way would be to just waste a bit of space here well not waste really but use the available space under the esp32 to try and improve the length you can see as I'm doing that the total length for the SDA line is increasing and it's

now at 59 it's getting closer another thing that I can do is to use a tool that K provides for length tuning so up at the route menu you see there's an option here using this seven shortcut key to attune the length of a single track so let's try this tool out so like that I want to change the length of this particular track you can see right now it's 41 mm if I start clicking and drawing to the left so I clicked held and then started drawing you can see that that length goes up so you still need to go up more so I can

continue Elsewhere on the track so now it's at 54 57 yeah I just reached 50 9 so now they are very close to each other I'm going to hit escape and check to see what the length is and you can see it's now 77 so the whole thing is actually bigger than it should have been I can then continue to fine tune so let's say I will make this smaller just click somewhere else to see what it is like now 67 yeah actually I'm pretty close now one thing that I don't quite like is this area here just going to make this a little smaller

like this make that a little smaller like that and let's see now 66 yep I do a little more fine tuning and now I've got uh 68.9 yep that's that's actually pretty good 68.9 versus 68. 29 that is well within the tolerances some last Define tuning 68.85 yeah I'm going to live it at that I'm pretty happy with this result so that's i squ c i squ c is now fully connected and I'll continue with the SBI interface down here let's continue with the SPI interface the S spr interface has pads on the right side of the esp32 there's
