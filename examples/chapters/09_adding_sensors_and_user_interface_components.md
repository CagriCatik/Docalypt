# Adding Sensors and User Interface Components



3 volt symbol which I have used recently I'm just going to place that there move these down a bit so csb will go to 3.3 volts just going do move that here so that csb will connect straight to that level and then I'll have the two resistors to also connect [Music] there and the other side of the resistors one will go to SC K I'm extending a little bit because I'm going to connect the net to that extended wire in a moment and then this SDI going to extend for the same reason done and then I will have two hierarchical

labels one is going to be SC right there and the other one is going to be SDA just going to improve the layout a bit move that up a bit using the G K to move and see if I can get those two wires up a little more yeah of course fix all this there's no connection there as much as possible I try to prevent having too many angles that can move in a little more like that now sdo will go to ground so what I'm implementing here is an address so with sdo being grounded the address for this device is 076 heximal on the other side I'll have

again the 3.3 volt symbol and I'll connect both V ddio and vdd to the same level then I'll have a capacitor just a simple ceramic capacitor this is C50 St and its value 0.1 U and that will go to ground like that and that implements the BME 280 so I'll put a box around it it's done let's continue with the ambient light sensor this is just an analog device so all we need here is a resistor to pull it up so this going to be our 23 let's make it 10K and that gets pulled up to 3.

3 volts since that is our supply voltage that goes there and uh then we also need a hierarchical label that will connect the output of this circuit to photo C that is the net that we will connect to one of the pins in the esp32 and of course on the other side we've got ground one thing I'll do here is I'm going to change the symbol of this shade label to be an output let's put a box around this block next is the microphone and the preamplifier there's a little bit more circuitry involved here start with the preamplifier on the other side on the

right side I'll have the power supply so it goes straight there I need a small capacitor so it's the same value as C15 so I'm just going to duplicate that that's going to be c18 one side is connected to 3.3 Vol the other side to ground let's grab a ground place it right here like that now here's the output so for the output I'll take a hierarchical label it's going to be mik out and uh that is also an output so that will go there connect this to like that and I need a feedback line to go back into in one right so from

here here just going to type the W key to start drawing and got towards the back I'm going to stop here because I need to include a resistor for line conditioning so here's a resistor that's 100K and that's r31 so from out that signal goes into the resist and from there it goes to the input there's also a capacitor here place that there that's C20 and it values again 0.

1 so that's fine as it is and connect it to the signal then from in I need one more resistor which is going to be r29 with a value of 1 Mega ohm that goes between that and ground now sorry this one is R30 and it's not 1 Mega ohm it's 10 kiloohms it's a pull down resistor I do have a huge 1 Mega Ohm resistor coming up for a voltage divider move that a bit to the left and continue with the Positive uh in so I need two resistors for that just going to copy one of them here so this is going to be R 29 and that is 1 Mega ohm it's part of a

voltage divider and it goes to ground and on the other side is r27 which is also 1 MGA and it comes out of N1 like that just going to move both of them up a little like that just using again the G key to move things around without breaking connections and from here in the middle of that divider I'll connect the output of the microphone and of course the ground goes to ground on the top side of that voltage divider connect the 3.

3 volt power There's One More Voltage divider just going to copy this resistor a couple of times the first one is 2K and r26 and the second one is also TK so I'm just going to duplicate uh 26 this is 28 yep correct connect that here that comes out of the output from the microphone so move the microphone symbol to to the left move that bit closer and connect the output to the bottom of the voltage ladder the top one goes to 3.

3 volts so I'm just going to move that here and connect it like that and then on the left side of the voltage ladder I've got one more capacitor that looks like this and it is C 16 and the capacitance is correct and from there connect one side to the middle of the voltage divider and the other side will go the ground and I think that the circuit for the microphone and in amplifier is also correct so I'm going to put it in a box so now I need to connect the two shades so the senses shade you can see there a few few hierarchical labels there's one 2 3 and four there's no need

to bring those hierarchical labels from the sensus page to the esp32 page so here is the box that connects it to together and I'm going to use this button here Place shade pin to bring those labels across so the first one is here I just do that click again bring the next one click again bring the next one and click again bring the next one and that's it we're done let's go back and finish up with the connections go to the esp32 and grab SDA SC photo C and mic out duplicate bring them across rotate and then just connect them with a

small wire H1 so here is SDA I can connect them straight away like this but I just prefer to have a small wire in between just to separate the box from the text soal photo and mic done let save and let's continue with the last sheet which is the user interface let's work on the remaining sheet which is the user interface so double click on the user interface and let's begin with the components in yellow background I've got the main components for this shade there j4 and j6 just notice there's no J5 and that is

okay so j4 j6 the two connectors I've got two transistors for the boot and enable buttons and there's two buttons there as well switch one and switch two and there's a few other smaller components like resistors Let's uh get started I'm going to add the two connectors first the first connector let's make it Con we need a connector for the dis lay which uses the ice quit C interface and therefore it requires four pin so there going to be one row with four pens I've got an option here of what kind of connector to

use I'm going to just go with a simple straight connector so this one here and I can always change later so there's the first connector for the second breakout uh which is the one that I use to just break out any remaining pins I'm going to need in total five pins so there's three gpios that I want to break out plus power and ground so let's do that I'm going to do something similar but instead of 04 I'm going to look for 05 and I'm just going to use the pin connector just for Symmetry and simplicity so this one up here is going

to be for the OED display if you'd like to connect to it otherwise you just have a breakout for the i squ c interface and this is for the gpio on the right side I'm going to break out a couple of buttons first let's see I think I've imported us lpt buttons yeah two of those so I need two of those one and two so one is going to be Boot and the other one is going to be enable switch one switch two and then I also need the two transistors and for this particular job I'm using the BC 817 npn transistors is using the sort or S 23

package and Q3 right there I'm going to work on the connectors first because they are really easy I just need to add a few labels and they're done and then we'll go to the reset and boot buttons so for the all LED display I'll start with power so 3.3 volts I'd like to have this around the other side so just move to the side so the pins can be connected on the left I also want to flip it over so I'm just going to flip there you go flip that over so that number one pin is on top because I'd like just for the sake of consistency

I'd like pin number one to be power and in this case like that and it's just that ground for pin 4 and then I'll have SDA and SC I'm just checking to make sure that the configuration of the pins as to which one is SDA and which one is SC matches my actual LED display let's grab a hierarchical pin iCal label I should say and this one is SDA it actually should be B directional so let's change that to B directional goes there this is s also be directional uh I'm just going to put a boook you can always use it to connect a

second I squ C or more if you want it doesn't have to be connected to an all LED display let's continue with J5 so I'm going to do the same thing flip it across and then vertically as well so the number one is on top going to duplicate these two and connect number one pin to 3.3 volts number five to ground and the rest are going to be GP ios's I'll use the H key the first one is going to be GP io8 bad directional I'm just going to copy this a couple of times to save a bit of time duplicate I should say second one is going to be

gpio 18 and the third one gpio 19 and finish with the connections okay that's done then let's go to the main part of this schematic I've got the two switches and down here I'm going to create a circuit to manage the signals for boot and enable what you're looking at here is a schematic from Espress if for the es32 S3 dev kit 1 what I'm going to do is just to implement the circuit down here that manages the the boot up process of the esp32 if you want to learn more about this have a look at this documentation page on the express if website that

explains how the boot operation in the boot ler mode works in the esp32 I've got a link to this document in the description below so I'm simply going to essentially copy this schematic here let's start with the two transistors I've got Q2 and Q3 here going to start with a bit that I always get wrong because I've got to cross some wires first I need a couple of resistors for the base place that there they both 10 KS actually one thing that I I should have been doing since the beginning of this uh work here is instead of just

doing what I'm used to be doing and double clicking on a symbol to bring up its properties I can simply look at the properties on this side by here just click on this button to reveal the properties for whichever symbol you have selected so you don't really need to double click anymore and go into the properties window you can do most of what you need to do in the properties window that appears on the side here's the fields reference and the value so I'm just going to add it directly in here this is going to be

r33 and the value is 10 kiloohms and I'll duplicate that resistor place it here and uh get the name right here this should be uh 34 which it is in 10 case next connect the resistors to the base and continue with the drawing of the wires for the two transistors it goes like this just going to move that out a bit so it's not too close so that's one thing then I need a couple of hierarchical sheet labels one here this is going to be uh DT right there and that gets connected like this and the second one is going to

be RTS that gets connected [Music] here I should move that further down actually there I think of it all right now there's two more hierarchical labels that I need to add the first one is en n and that is an input that goes there I can just connect it right there and and the second one is Boot and there is also an input and it goes in like that let just be more specific these are going to be outputs and same thing with this one so signal comes from buttons as an input to the transistors and then provides an output to the

esp32 all right so that goes there we're good with that let's continue with the buttons now I've got the button signal coming into the button S1 like this and I'm going to put a dip bouncing capacitor in there as well see like that this is going to be c21 and its value is 0.1 bit closer connect to the boot signal and the other side would go to ground so let's grab a ground symbol so it goes there from the other side pin four of the button goes back and gets connected to pin three pin one and pin two together get connected to

ground I'm not sure if I like this line going up over the component or can simply have a ground on the other side but it's aesthetic I'm just going to leave it like this so this is the boot Button I'm just going to use bit of text here to mark it as such this is boot another thing you can do here is to select this button and for the reference or actually for the value better replace that uh text with the text Boot and I'll just delete that label all right same thing for S2 I'm just going to place that with this actual R this is

reset so let's set it up just add a bit of space between the two buttons the first thing to do is to add a pullup resistor on pin three so I'm just going to duplicate r33 and flip it over like this the only thing I'm going to change is its reference designator 232 the value is correct as it is and connect it to three then I'm going to duplicate the label en n and connect that to pin three going to add a ground on the other side so that pins one and two are connected to ground and then another capacitor this is correctly c22

but as per the specifications the capacitance should be one microfarad and the goes here and pin number four also gets connected to the capacitor get another ground and connect it to the other side of the capacitor now one thing that I'll add here is an image of the truth table we have implemented here with the two transistors move that down a little and there's a button here that allows me to import images so click on that button I've taken a snapshot of this truth table a bit earlier saved it as a PNG image so go to the project

folder actually I think I put it in libraries uh sorry data sheets yeah I'll put it in here and here it is and there's the truth table it's just a an easy reminder for me to remember where this information came from you can even add a bit of additional text using this text box something such as to learn more about the ESP 32 boot mode go to and I've got a short link here T explore 4/ espb 32 Boot and that looks like this and I think it's handed to add content like this in order to make it easier for you to communicate with anyone else who

might be looking at your schematic and I'm going to actually do that as well once I finished with all the drawing I will add some annotation just to make it easier for anyone who's looking at this schematic to understand what's going on one thing that's missing here is of course 3.3 Volts for the pull-up resistor let's grab that place that here okay anything else no I think it's okay so I just need to link the sheet now with esp32 page two and I think we'll be done let's go back here as you can see the user interface box is

empty right now going to grab this tool and start adding the pins that are missing like that that's better I also think that this color is probably a bit destructive so I'm just going to make it a little lighter reduce the opacity let's finish up with the connections so um seal SDA n boot gpios three gpios just duplicate those for now and bring them down here and there's also the RTS and DTS then it's just a simple matter of attaching them to the correct place so RTS goes here okay so I've just noticed a mistake here this is DD where this is

DTS the correct name for this particular pin is DTR so let's fix that this is going to be DTR and I'm just going to search for DTS bring up the search panel down here search for DTS in labels and you can see that there is one right here so I'm going to change that to DDR and of course I could have done that on this side panel right here as well continue little fixes here and there as required so connect DD hierarchical sheet label to the local label then go for gp8 gpio 18 GP io19 on the other side I've got boot so

I rotate that enable and then SC and SDA I'll copy those or move those together done all right so this work is complete on the schematic I'm going to add some annotations but I'm going to do that offline and before we move on to the next step which is to work in the layout I'm going to show you the annotations and the final schematic before I continue so thanks for following so far and we'll continue in just a few seconds I've completed the schematic but there's a couple of things that I need to do before moving on to

the layout editor the first thing is to do the associations between symbols and Footprints so symbols are everything that you see here in the schematic editor and Footprints are the representations physical representations of these symbols that I'll be using in the layout editor the second thing is to do the validation and error checking I'll be using the schematic editor electrical rules Checker to do that so let's continue with the symbol and footprint associations there's a specialized tool for that which is this
