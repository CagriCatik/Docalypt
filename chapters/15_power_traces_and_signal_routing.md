# Power Traces and Signal Routing



missile and there's other involved pads on the left side as well and those routes have to go through to the SD card module clock Mossy cssd and this pad here as well for miso and there's also the flash memory here I'm going to move this module a little bit higher select it first in the filter then unlock it so that I can move it and I'm actually going to move that a little higher and the module with its components a little lower and place that mounting hole there my change position again later but for now that's okay lock

it again in place and I'm going to start drawing from here let's say furthest away and there also pad 18 that I need to route I'm also going to place the test points to the Final locations I'm going to do that once I know where the SPI tracks go I'm going to start with miso and start the track on the top layer like this I'm going to Route it under the SD card you can see that that is going first to R16 but I want to Route it to the flash interface right there to begin with now this is a good place for tppp2 which is misso so let's grab

that and I'm going to place it right there right on top of that track so I don't have to do any more work for tp2 done next I'm going to connect cssd so that's the select signal for the SD card that needs to go right right here so I'm going to start from the front copper Type X I'm going to need a v here to the bottom and continue down this path around here and resurface and connect it to cssd and that is also the pullup resistor and while I'm at it I'm going to take TP four and connected right there on the line one thing I need to fix here is

that this line as you can see is 90째 which is a bad idea so let's see if we can fix that yeah that's better 45째 is much better okay let's go back to the memory now the flash memory from here I let enable the rat nests so I can see what else is happening so you can see there's a connection from miso to R16 that's R22 to R16 so let's draw that like that and from R16 straight down to pad 7 from the other side of 522 let's finish up with the interface see misso signal to U6 now let's work ony and then we'll work on the clock you

can see this Mossy pad from U6 there it goes right here on R15 and actually I'll do the clock while I made it and that is a good location for the tp3 test point for clock just PL that right there as clock yeah move it up a little just improve the clearance done R15 the other side goes right there to pad six and for R20 the other side goes to pad five there's also a connection between pad two of the SD card to pad two of R15 so I'll do that now should be able to Route all that on the top layer just going to go this way and

connect it there just notice that I made an error here with the way that I connected the mostly pads together and the error is that I connected those together in a radial topology it's better for SB components to be connected to the microcontroller in a bus topology so what I'll do is remove this track here so get rid of this track you can now see that Mossy is going via pad 6 through R15 first to pad two of the SD card and then from here I'll connect it to pad five of U6 I've got a couple couple of options here as to how to cross that line here I

can go to the bottom layer but that is not optimal because of the high speed in the face I'd rather keep as much as possible everything on the top layer but I'm looking at this resistor here the gap between the pads of R16 is big enough for the track to go through so what I'm thinking is I can use that as kind of bridge I'm going to move R16 here and use it as a bridge so that the mosy track can pass through the two pads without having to go to the bottom layer that will require a little bit of moving things around so that means let's

override this lock let's move this up there and delete those tracks here and as a result I'll be able to easily connect mosy this done was easy H let's continue going to remove this bit here go a bit closer and then from here straight up restore the broken connections all right I think that's much better let's continue with the clock started the clock here then the next connection for the clock is to go to the clock pad of the SD card just going to go in between pads 7 and

six and finish the connection there there's also the chip select goes to going to move Tippy five here and let's see chip select for the flash memory goes down here all right so that's going to be a long Trace so let's go from here to here and then I will need to switch to the bottom layer I'll do that here continue until around here and switch to the top layer to finish up the last thing to look at is the lengths the most important track here is the clock so we want the clock to be as short as possible and therefore let's

measure it the total length for the clock is 26 mm the total of miso is 63.3 MM and MOSI 51 the main thing here is that the difference between miso and MOSI is not big for the total size and the frequency of operation for the spbi interface and the good news as well is that the clock is much much smaller than the two which is the more important consideration here the clock line is the most critical in terms of timing so this is the shortest and it's actually a fairly clean path so I'm pretty happy with that the other two traces mostly in

Miss are bigger compared to the clock but I'll see if I can make them any smaller but before I do that I'm just going to move tp1 to let's say maybe what would be a reasonable spot for it I think here would be a good spot there is a conflict so I'm going to move tp1 a little bit to the left so I can accommodate tp1 with their conflict so having done that the next thing I'll try to do is to minimize the length of those lines as much as possible they're not bad the way they are now but I think um at least see missile can be somewhat smaller I don't

want to make missile flip to the bottom side there so I'm going to continue working like this make that a little bit smaller like that so we are now at at 62 yep so we Sav 1 mm with the work I've done so far another thing I can do is increase the size of mosy by a little so like that just to make it a bit closer to miso it's now 52 yeah not a big deal the interactive router did something crazy here and it rerouted a nice clean route that I had to this weird shape so I'm going to hit undo a few times to undo this work that's

better yeah I'm going to leave it at that and if needed I'm going to come back later and see if I can make any further improvements that's it okay I'm going to stop here and then I'll continue with the power Tracer so anything that's got a voltage or ground I'll be routing it and completing it let's continue with the power traces this includes connecting pads such as the ground pads here the 5vt USB pads right here there's another 5V vbu there's also a lot of 3.

3 volt pads and all those will be connected using vs to the appropriate copper Zone in the inner layers and I'm going to do that in segments so I'm going to start from the bottom left corner of the board and then work my way up and then to the right and so on until all of those pads are connected to the appropriate copper Zone and Nets so I've got a ground pad here and the 5V USB pad the technique is the same regardless of what pad it is I'll create a trace to connect this pad to this pad here and move it to the side a little

and then this pad will go to the appropriate copper Zone using a v you can see that that's connected I'll use the same technique for the other pads as well so for the ground I'm simply going to use a V for this done in the center of this IC there's a big ground pad and or connected to pad three and to Pad 10 and from here pad three I just break it out to a VR like that going to come back to the 5vt pad and Zone here I've got two more USB pads here so I'm going to Simply break them out using vs like this of course I could connect it to

this pad here but I prefer this method here as well so I'm going to add one more like that there two more USB 5V pads so continue with the same technique break them out using vs done all right this looks okay remember that I'm not working with signals now just with anything that relates to power there is a large track that I'm about to create that will connect the 5vt pads and Zone to this set of pads so for that remember this is important because this is the track that supplies power to the entire board so I'm going to use a large track

like this one here this is a 1 mm track but I need to pass it through the polyfuse so may need to make a bit of room to get it through so I may need to actually move this component a little bit to the left so let's choose it and I'm aware that there are two copper zones here as well so I'm going to unlock this component and make sure that I can select everything on it and move that slow slly to one side and up to make sure that there is enough space here for the big track that I'm about to draw to go past uh before I

continue I just want to make sure that I didn't break anything and I can see that the connections are still fine as they are yeah all right so from here I'm going to draw let's switch that to 0.8 I'm going to use I'm going to create one more track size that's going to be one millimet so they don't have to make a change later so go for 1 millimet and draw this huge track oops Yeah it hasn't picked up the fact that this belongs to the 5V net because I didn't touch it to one of those pads select the entire track and assign that to the five

volt net should now be able to connect it not sure why didn't pick it up automatically but it's okay we can fix this through the properties all right that should be it it's done yep so that part is complete let's continue with those ground pads this will be easy I'm just going to go back to use net class widths and connect those together like this and see if there's enough space for vs in between yeah we do that that's fine I use use a similar technique for these so X and vs done these ground pads are already connected to the ground copper

net and let's work on the 3.3 volt Nets I'm going to use vs for this so X to draw a short trace and then V to go down to the 3.3 volt copper net same thing V connect these two together that's ground so break it down these two go together one of the benefits of using this technique is so that you don't draw long wires that may make it harder later on to draw other wires past them so they're not blocking the space between different parts of the board because these are so short they don't abstract R 11

done I've got C1 ground and uh the V bus that needs to go in here do need to choose a smaller trace for that and there's a v bus there as well right so let's see this is too big unfortunately I'm going to have to override the net class with with something smaller let's see if that works and then VR yes that did work and then VBS from here to C1 great another vbus from here to to right there done ground connect those ground pads these are through hole pads connect them [Music] together the proximity between those

pads is convenient so I can just create the connections using short white is on the other side I've got ground ground oh there you go something that I forgot to do earlier is I've got the differential pairs for the USB these are the alternate USB through holes on the USB connector so I've got DN and DP and you can see here DP and DN but I also need to connect those and to terminate them right here as well so I'm not sure if I can do this as a differential pair I should be able to do it so I'll give it a go so I'm going to stop up working

on the power nets for a moment and do this differential pair before I forget I'm going to start with B7 type A6 on my keyboard and start drawing no that's not going to work all right I'm going to start with a bottom copper layer and try again six on my keyboard ah yeah okay so that's what the problem was right so let's go around here and then maybe let's see I'm going to need to break to the top layer now I've got a better idea this not going to work so what I'll do is because I want to minimize how many vs I use and as you

can see it's pretty busy area here what I'll do is I'm going to use the two inner layers to help me with this situation what I'll do is I'm going to break out these two tracks on different layers so B7 I'll put that on the bottom Couer layer and then B6 in in a one Couer layer so that way they're not going to be conflicting it's going to look like this so I'm going to go for the back CER layer so select that and then start drawing like this and here use a v to break to the top Couer layer and finish the connection

for DP I'm going to do the opposite I've selected in a one copper layer start drawing here towards the other side just going to cross [Music] here and type V switch to the top cou of layer and finish the connection there okay just enabled all layers so we can see them and you can see that here's USB in and here is USB DP they overlapping I'm just going to just change the geometry a little bit move this V out of the way because the differential pair wires are more important and I want to minimize any discrepancies between the two

signals so I want to have the two traces be as similar as possible in terms of shape and length move that down a bit substracting yeah okay I think this is actually pretty good just move that down remove the segment it's redundant okay so there you go that's taken care of all right I can continue now with the power pads right so I've got okay I think that's it I need to correct

the widths of some of the 3.3 volt tracks you can see I've got them at 5 mm but I'm not sure if all of them are I think some of the 3.3 volt tracks are not at least 0.5 mm you can see this one here for example it is smaller and the same thing goes with the vs so what I'll do is I'll go to edit and then edit track and Via properties I want to make sure that all of the items that belong to the 3.

3 volt net will have a track width of 0.5 mm and the vs size is with a diameter of 0.5 mm and a hole of 0.3 mm so that's going to take care of all of those right it's done I'm going to double check to make sure that I haven't broken something there are two even more important tracks that I need to change even that setting so you can see here that this particular track here supplies power to the entire esp3 too so I'm going to make it even bigger I'm going to select the entire track so select that track and I want to yeah bring up its properties so I want to change its width

to make it 0.8 mm that's better so yes change all of those okay so big get is better and also need to change the size of the via here and I'll do that I'm just going to click up his properties actually so I'll be able to select one of the predefined sizes I've created here and that is um make it 0.

804 like that okay that's better I could have done it with the side panel but the side panel doesn't give me access to the predefined sizes that I wanted to use okay I think that's all I need to do with the power related pads Nets and vs so I'm going to continue next with the signals or anything that's now got a green line means it's not connected I'll go ahead and connect it I'll try to stick to the front Couer lay as much as possible but uh every now and then I will need to switch to at least the bottom coule layer going to switch back to use net

class width and hit X and start connecting at least the easiest tracks this one is not going to be easy I'm probably going to have to go from the top side because there's just too many thr holes here so let's see um around the back nope it's a bit too tight still no yes okay success it wasn't that easy

it's a bit tired so I had to change the shape of the differential pairs as well the previous change that I made here you can see that it actually had some uh an consequences and I've got like a huge track that is interfering with the pads so I need to reduce that so so let's select these 3.3

volt tracks and bring up properties let's see if I can actually actually now do it from here going to make this 0.5 I go a bit lower actually I'll go for 0.24 254 this is the sensor it doesn't really require that much power so that is not a problem at all I'll do the same thing for consistency for this track okay that's better let's look for more signals going to connect all these together using tracks okay I think I've done all the signals I don't think there's anything outstanding actually there are because I've been hiding those additional Nets

so let's enable everything that I disabled earlier so I can finish those routes there we go I was wondering I knew there were more it's going to be a tight fit yeah I'm going to need some more space up the top side but let's see if I can move this VI NY tied here so I will need to move these resistors a little higher this is this enough space for the routes on top of U1 so let's fix this up this

so then it goes all the way to the esp32 right so let's go from here keep it simple switch to the bottom layer continue up from here switch to top layer and finish from here I've got enable do something similar switch the [Music] bottom there's this one here that is

blocking my way so what I'll do it's going to move going to move this over here so that these can continue in the bottom layer until around [Music] here similar with this this is ground back room this can move over here then continue up this way until it reaches the surface right there okay continuing um I've got DTR and RTS

so this will have to go under right away and until reg around here same thing with [Music] DTR and for for

okay for [Music] I only noticed that like a moment ago is I finished the signal routing I was so concentrated on doing the signals that I didn't realize that somehow somewhere I managed to delete the copper Zone in the inner two copper layer that is for the grounds so that's why

you see all these rut nests indicating that the ground pads and holes and uh Nets are not connected not sure exactly how it happened I'm going to go back to the video review and see how I managed to do that but see I also ran a design rules Checker and these errors that you seeing mostly at least about the missing ground Zone let me just um quickly fix it before I do anything else except for this thing here I've got to fix that ra so it's it was just too close to those V all right well let's go back and and fix

that missing ground pane it's just weird how it happened all right in a coule layer one is where the ground Zone should be selecting a layer one for copper is bring up the zones tool and I'm just going to make a big zone for ground and finish it there all right that should be good now so I'm going to type the b key it should be it should fix that issue save now if I look at the search panel so I can have a look at the zones H okay I figured out what the problem was at some point I managed to misconfigure the ground and it's 3.3

volt copper zones and I had set both copper zones in one copper layer so to fix the problem I simply switched the 3.3 volt copper Zone to be in the in Copper layer as I originally intented again I'm not sure how the problem occurred where I made the change and that left the ground copper Zone by itself in the in one copper layer I'm just going to fix the name here as was experimenting I change the name to and in one all right so then after refreshing the zones everything is now as it should be and there's a couple of

things still to fix I notice that here the 3.3 volt pads here are not this pad here is not exposed to the other two so I'm just going to create a new Zone just to fix that issue so let's start go for a finer grid and let's start here all right so that's going to be 3.3 volt like that solid and everything is good so let's place that over here all these are 3.

3 volt 2.54 yeah that would do connect them all together and that takes care of that issue now notice there's a couple of other issues here again it seems like H there's no ground I think that's because in the in one copper layer only ground should appear not VBS so VBS should be in in2 so let's fix that sorry that should be in in2 and anything else in one yeah 5 Vol USB that should also be in the second inner copper layer all right so redraw done that was a tricky bug I confused in1 with in2 as I was assigning the copper zones to the

different layers and hence the problem occurred uh thankfully the rut Nest lines and then the design rules check make it easy to find the problem and fixing it is just very easy next up a design rules check make sure I haven't missed anything else big and then continue to finalize the board my board is about 90% ready to send to the manufacturer that's that's my estimate I know there's a few things that I need to fix and just looking at this board reduce a bit of the Clutter I can see that somehow I forgot to connect a

couple of items together and there's a few tracks that I can definitely improve remove unnecessary turns and remove some 90째 turns as well such as this one here but I'm sure that there's also other issues that I can't see right now just one more thing that I'll do to remove clatter is to uncheck the highlights or the shadows for the lock items there's also additional work that we need to do in the silk screen layer on the top side just to add more text in order to make my board a bit more professional so for

example descriptions for the various pens here in the headers and other things of that sort just to help with a final design but before I do all that I am going to run the design rules check just to reveal issues that I can't see so here's the redesign rule Checker I just clicked on this button right here and I'm going to run it just to get an idea of how much work is remaining to be done got a couple of unconnected items at as I suspected quite a lot of warnings and errors don't worry too much about this I don't think that the

situation is that dramatic and many of the servers are be able to just review them and then most likely put them aside not going to have to fix much let's do the unconnected items first obviously I'm just going to do this one here this is the easiest front copper layer tapping X on my keyboard just to finish with this connection and that's done and the other one is down here so for this to work better I will need to make a bit of room here and here so that I can then create a VR and pass the line underneath the board right here and then back to

the surface and I'm just going to improve the wiring like this okay run again nothing unconnected so let's go to the errors now so this error says that this particular via and most likely the other one here as well has got an anular width that is zero so essentially that means that the hole is equal to the diameter of the VR obviously this is not a good idea and it violates the constraint that I've got here of 1 mm so this is easy to fix I've got two vs to fix here the first way to fix it is to just double click on the VR bring up its

properties and then go for one of the predefined sizes and I think because this is a regular signal VR I can go for 0.5 0.3 and that would fix it but going to show you another way to do this that is a little faster especially when you have multiple vs to fix in this way so go to edit then go to track and Via properties and then select out of the filter a filter or filter combination that captures all of the items on which you want to make the change in this case I've got the net q3b so select that out of the drop- down and then I'm going to

go for vsi 0.5 0.3 that's it so both are now changed together if I run the DRC you see that that is sorted there's other issues to fix but this one is sorted other issues to fix here have to do with the ground again similar situation and you can see there there's a couple of those ground items that need to be changed uh that's that has to do with vs I'm going to follow the same process and go to edit truck and Via properties this one is going to be for the ground and I'm going to change this to 0.5 0.3 again like that run

DRC then I've got this set of Errors you can see there's multiple and they all have to do with the vs in the ESP 32 footprint now the thing about this footprint I'm just going to save as I go is that I'm just going to show you I got to the footprint editor and you see here that these vs are part of the original work whoever created the footprint for the esp32 set the vs here to this size I don't really want to change it and I've also checked with next PCB and they don't have a problem manufacturing the board with this

particular geometry here for the vs and the pads so what I'll do instead of trying to fix this I am simply going to ignore it like this so that takes care of that I'm ignoring this particular violation because I understand its implications and I know that it does not affect adversely the outcome of the board that I'm building so that's sorted let's continue I've got the few violations here the net class G and clearance 2.

0.2 01649 now the issue here you can see it's J1 and uh B1 and B2 are too close to each other B1 and B2 are too close and unfortunately again there's nothing that I can do about this because that is the footprint of the USB connector so again I'm going to ignore all of these next I've got some complaints about thermal reliefs you can see this copper area here connects G1 to the ground copper field and it's just a single thermal relief same thing happens here just a single thermal relief kicker would rather have two spokes for the

connection between the copper Zone and the pad unfortunately we can't fit more than one spook so I'm going to ignore that as well next more issues that I really can't do anything about this one here is about the solder mask apiture you can see that this pad here has got a solder mask that touches the pad adjacent to it this is what this complaint is about so again I'm not going to do anything about this because I can't really do anything about it and I will ignore it and that takes care of all of those violations next I've got a bunch of

warnings What's Happening Here is that I have a 3.3 volt VR connected to this track here however this VR is not connected to anything else that is 3.3 volt so it's that's why VR is not connected so what happened is that the Zone above the V Let's select the zones as well I need track and yep that's good so this Zone here is the 3.

3 volt Zone this one right here however when I created this V I kind of missed the Target so I need to move this V so that it can make contact with the 3.3 volt copper Zone this can be fixed simply by dragging this V and I'll place it here just to fix this line and also this area here because it's our 90째 turn which is not a good idea all right so that's it just going to type the b key to refill the zone and we've got 100 warnings now if I run the DC again it should be one less yeah then I've got an issue with the clip of the edge Cuts so u3 which is the esp32 has

got this line which belongs to the silk screen it's actually cutting through the edge cuts and that's a violation it's not dangerous of course and the there is no problem with the manufacturing but again it's part of the design of the esp32 footprint so once again I am going to select this specific violation to be excluded and there are two of them I believe three yeah so exclude this one as well there's a few others there now let's see here footprint does not match yeah okay so this particular footprint for the button does not match the one

that is stored in the library this is not a problem for me because what I'm looking at is correct so it doesn't really matter to me exactly what the difference is between this version and whichever version is stored in the library so I'm going to exclude both of these violations next up same issue with esp32 C3 I'm going to exclude this I'm going to exclude this as well same issue now I've got a lot of violations relating to the size of the text I saw really a bunch of them so what happened here is that I made this text too small and I can have

a look at the capabilities of the manufacturer when it comes to text all right so according to this the minimum line width is 5 m that's a minimum so that's 0.12 mm and the maximum text height is 0.76 mm if I look at what I've said the constraints to be for the silk screen I've set it for 0.

8 the minimum text height which is correct and the thickness set it too small so this should be 0.12 having fixed that in my constraints and now I need to fix all of the text so I need to fix all the reference text labels so let's go to edit edit text and Graphics properties and everything that is on the front Sil screen there is a reference designator I'm going to change the text width to be 0.

8 the height to also be 0.8 and the thickness as small as I can make it with think that capabilities is 0.12 so I'm going to apply this to all of them and they're close so that made all the text bigger and I'm going to have to make it fit properly but at least it removes all those violations and I know that it will be properly printed by the manufacturer now I've got a bunch of other things again probably because of what I've just done and you can see here one example silk screen clipped by S The Mask so now I've got silk screen on the S mask and on the pad so I need

to move things around so I'm going to remove the groups so I can move things around and start moving all the text off the so mask or the okay I think I got got the all let's repeat the check to see if I missed any three warnings oh I missed one here let's move that out here actually move LED there and C3 here all right there's a couple of items that requires me to ungroup so that I can grab C1 and I'll place it here there's one more thing at this one silk screen C by sold the mask so you can see this dot here this dot actually

belongs to the ESP 32 footprint now to fix it I'm going to have to actually edit the footprint right click on the footprint click on open in footprint editor I will need to move this dot somewhere else just going to change the grid and pick that item and move it say right there save go back and see if that resolves the issue yeah I think that would do it so let's do one last check run DSC all right that's fine as we know I've just made a change to the esp32 module and that is okay to exclude it cool so you can see all the ignor
