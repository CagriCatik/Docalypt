# Setting Up the PCB Layout Editor



blank layout editor before I draw the footprints from the schematic editor to layout I want to do a little bit of setup first thing to do is to go into the board editor layers and have a look at this as you can see right now by default the project is set up to have two layers but because of the complexity in the size and the number of components on this board it's not going to be impossible but it's going to be very difficult and tedious to make all that fit in a TW layer PCB so what we'll do is make that a four layer PCB via the

physical stack up you can see copy layers and now four and then let's go back to the board editor layers and have a look at the settings here in the board layout layers here I can tell kick out the roles of each one of those layers you can see that for most of them the roles are fixed but for some of them the copper layers in particular I can choose a particular role now my plan as you know is to have a four layer PCB where in the first layer I'll be placing the actual components so components will be only on the top copper layer and on the

top copper layer I'm also going to have the tracing for the signals I'm going to use the bottom copper layer also for routing signals for the first inner layer I plan to use that as a power plane but to specifically contain a large copper zone for ground so having a dedicated ground plane helps to reduce noise and provides a low impendence return path for signals it also acts as a shield between the top and bottom signal layers and that helps to minimize electromagnetic interference and cross talk for the second inner copper layer

this one right here I'm also going to mark it here as power plane and that is going to have a variety of voltage levels above zero so I'm going to have for example a 5vt copper Zone there's going to be a couple of 5vt copper zones and there's also going to be a large 3.3 volt copper Zone that will provide power to the various components that operate at 3.

3 volts and just like the first in a coupple layer the second one also acts as a shield between the top and bottom single layers so that's good the way it is then physical Stack Up You' already seen what I've done here the only change that I made was to change a couple layers to 4 I'll be using F4 dialectric material for the various layers so the rest are fine as they are for Board finish I'm not going to make any changes same thing with so the mask and paste or good let's continue with other details now this is very important the design rules and their constraints it's

important because this actually relates to the reality at the manufacturing floor since I'll be using next PCB to manufacture this board next PCB publishes its capabilities in this page right here you need to make sure that any numbers that appear in the board setup constraints is equal or larger to the relevant Row in your manufacturer's capabilities so I give you an example let's have a look at the minimum track width you can see that here by default it's zero which means that you can according to kard you can have a track

that has a width of 0 mm obviously that doesn't make sense so we will need to put a reasonable number in this box but what is a reasonable number so we got to next pcb's PCB capabilities have a look at where this information might be so there's minimum Trace width and spacing that looks what we need there's the number that I was looking for the typical copper weight is this much here for the inner layers and this much for the outer layers my plan for this PCB and the final manufacturing is to have a good balance between the performance and

that includes things such as the size for example weight Etc and the cost as much as possible I'll be choosing standard settings for the PCB so you can see here in the PCB quote page I scroll down to around say here you can see outer copper weights the default is one o but you've got other weights as well for let's say Bia boards but the standard is one o the rest will be more expensive so if I go for 1.

5 o you'll see that the price goes up and the total would be $70 I got back to one o which is the standard weight for the copper look at the difference in price here a significant difference so I'll be going for one o now for one o the minimum Trace width is 0 .08 mm so that's as slow as you can go and of course if you put that number in here there's a trace width the lower you go the more expensive your board gets so the smaller the width the higher the cost in my case here I'm going to configure the PCB Editor to use a

minimum Trace width slightly higher than the absolute minimum that the manufacturer is capable of I'm going to put in 0.2 mm I've done similar type of research to fill the rest of the numbers and to save a bit of time I'm just going to go ahead and finish up with this work just going to okay so this is fine as it is next continue with the pretty fine sizes going to add a few tracks vs and differential pair sizes that that I'll be working with frequently so just click on the plus button here to add the sizes

so only need to type in the number and the millimeters is in so I'll be using 0.2 0.254 I'll be standardizing most likely around 0.2 and 0.54 mm so the rest are just extras that I'm probably not going to use for the vs and finally for the differential pairs I'm going to have a couple okay so that's it with the board setup teardrops I'm going to leave it as it is for the length chaining patterns I'm going to make a small change here because of the sizes of the tracks that we'll be using I'm just going to make that amplitude a

little bit smaller or half to be more specific and for the spacing also half same thing for the differential pairs can make it one 0.15 and one the last and most important item to look at in the board setup is the net classes as you can see right now it's empty and if I try to add net classes it's not going to work because I haven't imported anything from the schematic editor into the layout editor so the kick layout editor right now has no clue as to what the various Nets are got a couple of ways to deal with this issue

the first way is to just cancel out of the setup window and then go into the layout editor and import the footprints and everything else that's associated including tracks and Nets from the schematic editor and then I'll be able to go back in here and continue with my net classes and net class assignments setup but the other way that's actually my preference is to go back to the schematic editor go into the setup and set up the net classes here and then when I do the import of the schematic data into the layout editor all that

information within the classes is going to come across as well and then on the layout editor the only thing that I'll have to do is to set up the various sizes as you can see here for each one of the net classes and the advantage of doing that is then when I start to design any tracks that belong to each of these net classes they various geometries for that track will be inherited from whatever I've set up in the net class right here so that's a right way to do it in my opinion so I'm going to go and do that

now the first thing to do is to set up the net classes up on the top side and then assign Nets to the net classes I'm going to have a lot of net classes set up here I'm going to fast forward this bit so you don't have to bear through all of my typing so I've completed the setup of the net classes so you can see I've got net classes such as 3.

3 Vol and 5V USB and ground that have to do with power and there's others that have to do with signals such as SPI sensor data gpio Etc because I like what my schematic looks like just got these new net classes to inherit whatever settings such as wire thickness bus thickness the color and the line style of the default net class so I'm going to move down to the bottom part of this window and do the assignments of Nets to net classes the assignment operation uses regular expression like Expressions say that I want to set up the net class assignments

so that this net the plus 3.3 volt net belongs to the 3.3 volt net class the way I do it would be to be literal and just say plus 3.3 volt and you see that there's a match here that belongs to the 3.3 Vol net class another one would be the 5 Vols got a couple of 5 volts actually got the plus 5V net here and there's also the 5V bus this one right here this plus 5V net will be a member of the 5V USB all right so I've got all the net class assignments that means Nets to net classes and now that I have the net classes I'll be able to go into

the layout editor and set up the net classes there in terms of the geometry of the track after I import the data from the schematic to the layout editor let's go ahead and import the schematic into the layout editor so in the layout editor I'm just going to click on this button up here in the top two bar update PCP from schematic and let's see it says it's found most of the components but he hasn't been able to find a few Footprints here wonder if this is a issue related with what the ERC showed in the schematic editor okay I may need

to reassociate these components but I'm just going to ignore it for now and drop all the components here because I want to just finish up with a setup so I'm here in the board setup net classes you can see that all the classes that I set up in the schematic editor are now available in the board setup in the layout editor here's the assignment ments and the classes up on top and what I want to do now is to populate this table with actual numbers so each one of these classes will have its own setup for clearance track withd vsis and Etc

once I do that I'm going to go back to the schematic editor and sort out the issue with the missing Footprints here in the board setup I'm just going to populate these numbers start with a 3.3 volt and work my way up here I've completed the setup of the net classes and the main thing to notice here is that I've spent some time figuring out what the appropriate especially truck widths and the sizes and holes should be the clearance is also important in order to avoid things such as cross talk now the they might be

wondering why I came up with these numbers there's there's two things in play here one is I know that any track that conveys power requires a larger truck width than tracks that convey signals because there's a lot more current passing through a power power track versus a signal track so you can see here that the 3.

3 volt track width is 0.5 mm versus for example an SBI track which is 0.3 or USB data at 0.25 mm and actually when I am drawing the tracks in the editor you'll see that in particular for the 5V USB track I'm actually going to make it much bigger manually than what I've got in the net CL here depending on how much space I have around the track kindly try and design it so that the 5V USB track is as large as possible another thing to notice here is that I've set those numbers especially for the for the width from experience now if you want to be

more precise in how you set up your tracks you can use the calculator so go to the calculator tools and one of the tools here you can see is the track width and you can sum up the the maximum Cent draw from all of the components on your board let's say that it is say 1.5 amps and then let's say the conductor length would be say about let's make it 15 mm and let's say that for a let's say 5 mil thickness track the track width should be 0 14 mm this number relates to external layer tracks remember that most of my power tracks

are going to be internal so if I apply the same numbers to an internal track then you see that the track width for the numbers that I've selected goes to 9 mm my estimate is that this board would draw a maximum of around 450 milliamps so that number here would be 0 point let's make it 0.

500 amps and that would be the draw when the esp32 is its maximum performance the BM 280 doesn't really draw much the max 4466 would draw about 0.6 milliamps and so on and let's say that the LEDs are also working all together at the same time so that that would get the board Carro to about half an amp so for for that half an amp the track width would be 0 mm for an internal layer okay so I keep that in mind when I do my drawing and also one important reason for using an entire layer in my case the second layer of the PCB for power purposes is to be able to provide enough power to

any part of the board that's needed without the use of tracks we'll be using entire copper stones to provide Power but anyway if if you are curious and you want to know how to precisely calculate the width of particular truck that is used for a particular purpose then you can come and use a calculator here okay so we've got the net classes all set up now the next thing that I need to do is to try and figure out what's happening with those missing Footprints remember there are a bunch of footprints here that kick out was unable to find so what

I'll do is go back to the schematic editor and relink those missing Footprints in my previous attempt to import the schematic data into the layout had partially succeeded got a bunch of footprints here but several Footprints they important ones actually are note here if you remember when I did the import and I'm just going to go ahead and do it again you can see that I've got errors down here there's a few inputs that kit cat cannot find paint the footprint for and I spent a bit of time trying to figure out what that

means and why and I think I have figured it out I have exported the report from the import tool in text so that I can have it handy so let's go back to the schematic I'm just going to put the report here and let's have a look at the associations tool I didn't realize it at the time but I do now and maybe that's just a new feature and at n that I haven't seen before or maybe it didn't click as I was doing the recording but see how these items are highlighted with the different color background these are pretty much the errors so for example

here one cannot add MK1 because this particular footprint is not found you can see that MK1 is highlighted and so is q1 right here there's q1 and so on so I incorrectly assumed that these Footprints were already associated with symbols correctly and that is true because when I downloaded the symbols and Footprints from snapa the associations were already set but the way that the associations were set and the paths with set in The Originals was that symbols and Footprints would be in the same directory but what I've done in

my project directory is that I've got them separated here are the footprints all in the same footprint directory and here are the symbols all in their own symbols directory and of course these pre-existing associations broke down let me become a little bit more specific let's go into MK1 I'm just going to search for that so view panels search search for symbol MK1 click on it and that's a microphone K will take us straight there I double click on this symbol to bring up its properties actually I won't do that I'm just going

to use a side panel here all right so you can see in the side panel that there is a library link going to this place here which I can't edit but I also want to have a look at the footprints which is not showing in the side panel so here is a footprint the problem is that this footprint is not correct okay it's changed so I will need to re link the symbols with the footprints and there's a couple of ways to do that the first way to do is to do it manually for each of these components so since I have my MK1 opened just going to click on the

library button here and that will take me to the footprint Chooser and in here going to go into esp32 project Footprints which I configured at the beginning of the project and I'm looking for cui CMC this footprint right here click okay and now I have the correct Association click okay save and let's go back to the layout editor and import the entire schematic and see what happens with the specific component MK1 all right so MK1 has now been eded see updated right there I've got to do the rest I'm just going to leave it here all right let's

continue and do the rest now but instead of doing them one at a time I'm just going to go into the symol Chooser and from the left side here I'm just going to s select the projects Footprints so right here is32 project Footprints and let's go and do this substitution one by one so first SS 5240 that double click edit next is the B2B pH sm4 TB double click to commit it next is gstd 090 this one right here double click this set it next to EMT trans T EMT that continue that's the two buttons switch us lpt to of those for both

buttons next is the bme280 and the package is PS n65 this one next is the esp32 module this one next is the Silicon Labs qfn 20 I'm going to come back to the qfn 20 in a moment because I'm going to use one of the Kat inbuilt libraries for that next up is uh this one here is so 127 that next sort 65 and finally the um regulator it's this one MPX 3.

3 all right the last item in the list is the serial T USB interface chip so that package dfn for this I'm actually going to go into the kiat light liaries and relink it there so that's package dfn let's see dfn qn let's enable these filters as well the one that I'm looking for is the qfn 21 ep3 by3 and making sure that the dimensions are correct 0.5x 1.8x 1.

8 mm that's the one so double click to link it now all of them are properly linked so apply save and continue and click on K save the project and go back to the layout editor and let's repeat the process once again and that's it I've got everything imported so close and there's my additional components I'm just going to put them here for the time being now that I have all of the components imported into the layout editor I'm just going to to do the placement and after that I'll continue with the routing all of the components are now in the layout

editor so the first thing to do is to work out a way to combine these components together in a way that resembles the final layout of those components on the Ford now what I'm going to do here is to follow some guidelines that just press if proposes for the esp32 module that I'll be using which is uh this component here with the integrated antenna and then I'll be following some more General guidelines as to how to place other components in association with the esp32 which is going to be a central component everything is going to depend on the

esp32 and its position aside from those two items the third guiding principle that I'll be using here is the placement of the various components that the user will be interacting with such as this component here which is the SD card module obviously you want it to be at a location on the board that makes it straight forward for the user to insert and remove SD cards so you don't want to put it right in the middle of the board and there's a couple of buttons right here you want them somewhere on the board that makes it relatively simple

and easy to press them with your thumb or your index finger there is a USB module you want to play place that component somewhere that makes it easy for you to insert the USB cable and attach it to the board and there's a few other components that I would call them as user interface components including things such the LEDs you want the LEDs to go somewhere that it makes sense so you put the Power LEDs for example near the USB connector so that it's easy to see that the power has been applied when you insert a USB cable so these are the

general principles that I'll be following to uh guide me through the component placement process in the next few minutes I'm going to drag the components and place them on the board in the generally final positions I may do some fine tuning a little later but as far as the location of each component pretty much where I drop it is where the component is going to stay one more thing I should mention before I start dragging the components uh and start the placement process is that I've already had sever runs of this each time that I

did a draft placement I just improved on the previous one so what you're going to see is the final configuration of the PCB which I find quite good and meets all of the three criteria that I mentioned earlier I'm just saying that so that you know that it's okay to iterate through versions of placement before you start doing the routing of the tracks so take your time here because it's very important to get this right especially if you start with the routing and then you realize that placement is not good you are going to

have to undo a lot of work whereas if you take your time to go through a series of versions for the placement of the component until you reach a final version that you are happy with it's going to make the routing much easier and it's going to decrease the risk of having to undo and redo a lot of work now I want to show you a couple of sources of information that guided me with the placement process one of the data sheets that I've got here is this one here from Espress if it talks about the physical dimensions of the module

the module that I'm using is this one here there's another version that doesn't have the PCB antenna instead it's got a connector here that has fewer requirements so when it comes to the placement but since I'm using this one here the one with the built-in PCB on antenna I need to pay attention to what expressive recommends down here there's another interesting section uh section 11 that talks about the PCB layout recommendations and there is a link here module placement for PCB design there is a reference to this online resource that

is this page right here and here you'll see PCB layout design click on that and you'll see recommendations from espresso I I incorrectly applied a few of those variations so for example my very first version of the PCB was something like this like a rectangular PCB with the esp32 right in the middle top Edge and my thinking about that was that this way there will be a lot of space around the two sides of the module to Route tracks in and out however as you can see the tick mark is on position three So the antenna is away from other components

and that puts a bit of restriction on the pads on the right side of the module another approved position is position number four so the other corner there's another couple of options here if a feed is pointed on the left side then positions one and five are approved I kind of didn't like any of those options because the PCB antenna part of the module was sticking out too far and I was worried that it's going to break or interfere perhaps with the Project Box that I'm planning to design as well luckily there's another recommendation

that is press F offers and that is this one here so there is a cut out of the board and then you can put the esp32 kind of in the middle of the board and the interference is avoided because of the space that is allowed on either side of the antenna and you've got the dimensions there as well so that was a bit better what I decided to do eventually was to go for a combination of the two both having the module on one of the edges I chose the top right Edge as well as having the cut out especially the space here between the board and the

left edge of the antenna that you can see right here and that would give me the best of both worlds having the module on the right side and enough space from the PCB itself to diminish any potential IND experience so that's what I went for now what you see here is the final version of my PCB layout the one that I'm about to start designing here and it's also the one that is being manufactured right now and you can see the other elements that I mentioned earlier you've got the microcontroller on the top right side then you've got

other components with which this microcontoller unit needs to interact at a relatively high speed so I've got the flash memory and the SD card very near the MCU just to minimize the length of the tracks for the high-speed signals there's space around all of these devices for the various capacitors and resistors that are needed for Signal conditioning then I've got the user interface components along the edges so you can see SD card right there easy to access the USB port the buttons the charging port and the gpios All In the

periphery makes it easy to interact with those components and there's the LEDs here quite easy to see I've Got The Power LED you can see right here in the regulator area and then the sensors are all together you can see the sensors here I've got three sensors on this board there a microphone the environment sensor and the light sensor having said all that let's continue with the placement most of the time I'll be working with both editors side by side so the schematic and the PCP editor so that there's some clicking on components

I'll be able to see what's happening with the relevant component that I clicked on on the schematic editor but now since I'm just doing the placement and I kind of know what these components are I'm going to use as much available space as I can in the layout editor and before I start I just want to check the grid for the PCB editor these are the grids that I'm using you can see for the footprints I'm using 0.025 or 0.

98 Ms precision I'll be using the grid overwrites for this so this gives me a lot of control this is a very small grid so I think it's going to be okay for the size and amount of components that I'm going to work with so the grid is enabled let's begin I'm going to start with the ESP sp32 component I'm just going to put it there continue with the SD card place that there you can see that another thing that I can do here actually going to have the two windows side by side because I'm going to show you a really nice trick that you can do when you're

doing the placement so you can see that when I click on the component on the one side the same component on the other side is highlighted and vice versa if I click on this component here on the schematic editor you can see that it is highlighted in the layout editor so I'm going to take advantage of this feature it's very neat so what I'll do here is I'm going to select all of the components in the esp32 group so that they are highlighted in the layout editor and that way I can pick them apart and put them together this is particularly important

to minimize tracks of course but also in this case it's because for the purpos of signal conditioning and I need to know which capacitors actually belong to the circuitry that supports the esp32 so I put all those together I'm going to not worry about the final placement of those smaller components now but the fact that they are next to the esp32 is all I need for now and I'm going to do the same thing for the SD card highlight the SD card components in the schematic editor that picks them apart in the layout

editor so now I can put them all together just put them side by side and I know that it will be easy to figure out which component goes where when I start focusing on these components and this smaller bits and pieces in their vicinity all right so that's done let's go for the flash memory because the flash memory circuitry as I mentioned earlier is going to be going for a placement near the esp32 so these parts make up the flash memory circuit Tre just uh put them together that I'll place it here next I'm going to go for the USB

module so now that I have the approx location of the components I'm going to draw a box that will start resembling what the outline of the final board is going to look like let's go to Edge cuts and because I'm going to have a cut out here I'm not going to use the box of selected Edge Cuts here normally I would just take a box and enclose the components in the box like this but the Box doesn't allow me to have that cut off here so instead in I'm just going to use a line tool so I'm going to start down the bottom just making sure that

there's enough space on the side of the esp32 to be able to draw tracks a little later on you can see my grid size is 0.05 I'm actually might actually make a little larger 0.1 mm and disable the override so that I can actually draw at that size let's pick up the line tool and start drawing actually going to go less I'm going to go for 0.
